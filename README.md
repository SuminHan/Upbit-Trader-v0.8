# 업비트 암호화폐 자동매매 시스템 상세 설명

## 1. 시스템 개요

이 시스템은 업비트(Upbit) 거래소의 API를 활용하여 암호화폐를 자동으로 매매하는 프로그램입니다. 기술적 분석 지표를 기반으로 매수/매도 신호를 생성하고, 설정된 전략에 따라 자동으로 거래를 실행합니다.

## 2. 주요 기능

### 2.1 트레이딩 전략
- **멀티 타임프레임 분석**: 1시간봉과 5분봉 데이터를 동시에 분석
- **기술적 지표 사용**:
  - RSI (Relative Strength Index): 과매수/과매도 판단
  - MACD (Moving Average Convergence Divergence): 추세 전환 신호
  - 볼린저 밴드: 가격 변동성 분석
- **동적 임계값**: 백분위수를 사용하여 시장 상황에 맞는 유동적인 기준값 설정

### 2.2 리스크 관리
- **손절매 기능**: 매수가 대비 10% 하락 시 자동 매도
- **포지션 사이즈 제한**: 코인당 최대 10만원 보유
- **시간 제한**: 1시간 내 추가 매수 제한

## 3. 코드 구조 설명

### 3.1 CryptoTrader 클래스
자동매매 시스템의 핵심 로직을 담당하는 메인 클래스입니다.

#### 주요 속성
- `access_key`, `secret_key`: 업비트 API 인증 정보
- `upbit`: pyupbit 라이브러리를 통한 API 클라이언트
- `upbit_balances`: 계좌 잔고 정보
- `BASIC_UNIT`: 기본 거래 단위 (5,500원)
- `MAXIMUM_BUY_PER_COIN`: 코인당 최대 매수 금액 (100,000원)
- `ticker_list`: 거래 대상 코인 목록
- `last_bought`: 마지막 매수 시간 기록

### 3.2 주요 메서드 설명

#### `refresh_balances()`
- **기능**: 계좌 잔고 정보 갱신
- **동작**: 업비트 API를 통해 현재 잔고 정보를 가져와 `upbit_balances` 딕셔너리 업데이트

#### `get_balance_krw(ticker)`
- **기능**: 특정 코인의 원화 평가액 계산
- **동작**: 평균 매수가 × 보유 수량으로 평가액 산출

#### `get_current_price(ticker)`
- **기능**: 현재 시장가 조회
- **동작**: pyupbit를 통해 실시간 시세 정보 반환

#### `get_current_balance(ticker)`
- **기능**: 현재 보유 수량 조회
- **동작**: 잔고 딕셔너리에서 특정 코인의 보유량 반환

#### `buy_coin(ticker, won=None)`
- **기능**: 코인 매수 실행
- **제약조건**:
  1. 최대 보유 금액 초과 방지
  2. 1시간 내 추가 매수 방지
- **동작**: 시장가 매수 주문 실행

#### `sell_coin(ticker, won=None)`
- **기능**: 코인 매도 실행
- **동작**: 보유하고 있는 전량을 시장가로 매도

#### `add_indicators(df)`
- **기능**: 기술적 분석 지표 계산
- **생성 지표**:
  - RSI (14, 24, 60 기간)
  - MACD와 시그널 라인
  - 볼린저 밴드 (20기간 이동평균 ± 2 표준편차)

#### `get_trade_signal_multi_tf(ticker)`
- **기능**: 매매 신호 생성
- **매수 조건** (모두 충족 시):
  1. 1시간봉 MACD 골든크로스 (MACD > Signal Line)
  2. 1시간봉 RSI가 하위 30% 미만
  3. 5분봉 RSI가 하위 30% 미만
  4. 5분봉 종가가 볼린저 밴드 하단 아래
- **매도 조건** (모두 충족 시):
  1. 1시간봉 MACD 데드크로스 (MACD < Signal Line)
  2. 1시간봉 RSI가 상위 20% 초과
  3. 5분봉 RSI가 상위 30% 초과
  4. 5분봉 종가가 볼린저 밴드 상단 위
- **반환값**: 1 (매수), 0 (관망), -1 (매도)

#### `make_decision_and_execute()`
- **기능**: 매매 결정 및 실행 (메인 로직)
- **동작 순서**:
  1. 잔고 정보 갱신
  2. 각 코인별 매매 신호 생성
  3. 신호에 따른 매수/매도 실행
  4. 현재 상태 출력
  5. 손절매 조건 확인 및 실행

## 4. 프로그램 실행 흐름

1. **초기화**: API 키로 트레이더 인스턴스 생성
2. **메인 루프**: 
   - 잔고 정보 갱신
   - 각 코인에 대해 매매 신호 생성
   - 신호에 따라 매수/매도 실행
   - 결과 출력
3. **무한 반복**: 설정된 간격으로 계속 실행

## 5. 보안 고려사항

- API 키는 환경 변수로 관리
- 실제 운영 시 별도의 설정 파일이나 암호화된 저장소 사용 권장

## 6. 추가 개선 가능 영역

1. **백테스팅 기능**: 과거 데이터로 전략 검증
2. **슬리피지 고려**: 실제 체결가와 예상가의 차이 반영
3. **거래 수수료 계산**: 수익률 계산 시 수수료 반영
4. **더 세밀한 리스크 관리**: 변동성에 따른 동적 포지션 사이징
5. **로깅 시스템**: 거래 내역 및 성과 기록
6. **텔레그램/이메일 알림**: 주요 거래 및 에러 발생 시 알림

이 시스템은 기술적 분석 기반의 자동매매 전략을 구현하고 있으며, 실제 운영 시에는 충분한 테스트와 모니터링이 필요합니다.
